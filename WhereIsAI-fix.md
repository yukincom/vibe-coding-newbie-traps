
title: "Skill: El Capitalã«ãŠã„ã¦Gemini APIãŒå¿œç­”ã—ãªã„ã¨ãã®åˆ‡ã‚Šåˆ†ã‘æ‰‹é †"<br>
skill_type: "debugging"<br>
target: "AI Agent / Backend Developer"<br>
difficulty: "intermediate"<br>
last_updated: "2026-02-04"<br>
<br>
environment:<br>
  - macOS (Apple Intel)<br>
  - Python 3.8.1<br>
  - Flask Server<br>
  - Gemini API<br>
tags:<br>
  - Gemini
  - API Debug
  - dotenv
  - HTTP
  - Networking
  - Model Selection
---

# ğŸ¯ Skillæ¦‚è¦

Gemini APIãŒã€Œå¿œç­”ã—ãªã„ã€ã€ŒAPIã‚­ãƒ¼ãŒç„¡ã„ã¨è¨€ã‚ã‚Œã‚‹ã€ã€ŒHTTP 200ãªã®ã«AIãŒå‹•ã„ã¦ã„ãªã„ã€å ´åˆã«ã€  
åŸå› ã‚’æ®µéšçš„ã«åˆ‡ã‚Šåˆ†ã‘ã¦è§£æ±ºã™ã‚‹ãŸã‚ã®å®Ÿå‹™æ‰‹é †ã€‚
---
# 1. APIã‚­ãƒ¼ãŒç’°å¢ƒå¤‰æ•°ã¨ã—ã¦èª­ã‚ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ ğŸ”‘

## çŠ¶æ³

`.env`ã«ã‚­ãƒ¼ã‚’æ›¸ã„ãŸã®ã«ã€ŒAPIã‚­ãƒ¼ãŒå…¥ã£ã¦ã„ãªã„ã€ã¨è¨€ã‚ã‚Œã‚‹ã€‚

## `.env`ä½œæˆä¾‹

```bash
cat > .env << 'EOF'
GEMINI_API_KEY=ã“ã“ã«Gemini APIã‚­ãƒ¼ã‚’è²¼ã‚‹
EOF
````
## Pythonå´ã§dotenvã‚’å¿…ãšèª­ã‚€

`server.py`å†’é ­ã«è¿½åŠ ï¼š
```python
from dotenv import load_dotenv
load_dotenv()
```

## åˆ¤æ–­

* APIã‚­ãƒ¼æœªè¨­å®šã‚¨ãƒ©ãƒ¼ã‚„500ã‚¨ãƒ©ãƒ¼ã¯æ¦‚ã­è§£æ¶ˆã™ã‚‹
* ãŸã ã—ã€ã“ã‚Œã ã‘ã§ã€ŒGeminiæ¥ç¶šæˆåŠŸã€ã¨ã¯æ–­å®šã§ããªã„

---

# 2. HTTP 200ã‚’ã€ŒæˆåŠŸã€ã¨èª¤è§£ã—ãªã„ âš ï¸

## ãƒ­ã‚°ä¾‹

```
POST /chat HTTP/1.1" 200 -
POST /game/update HTTP/1.1" 200 -
```

## è§£é‡ˆ

HTTP 200ã¯å˜ã«ï¼š

* ã‚µãƒ¼ãƒãŒæ­£å¸¸ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ãŸ

ã¨ã„ã†æ„å‘³ã§ã‚ã‚Šï¼š

* GeminiãŒå‘¼ã°ã‚ŒãŸ
* AIãŒå¿œç­”ã—ãŸ

ã¨ã¯ä¸€è‡´ã—ãªã„å ´åˆãŒã‚ã‚‹ã€‚

---

# 3. try/exceptã§å¤±æ•—ã‚’éš ã—ã¦ã„ãªã„ã‹ç¢ºèªã™ã‚‹ ğŸª¤

## å±é™ºãªãƒ‘ã‚¿ãƒ¼ãƒ³

```python
try:
    gemini_response = call_gemini()
except:
    return "å›ºå®šæ–‡"
```

GeminiãŒå¤±æ•—ã—ã¦ã‚‚å¤–ã‹ã‚‰è¦‹ã‚‹ã¨å¸¸ã«200ã«ãªã‚Šã€éšœå®³ãŒéš ã‚Œã‚‹ã€‚

## æ¨å¥¨å¯¾å¿œ

ä¾‹å¤–ã‚’æ¡ã‚Šã¤ã¶ã•ãšãƒ­ã‚°ã‚’å‡ºã™ï¼š

```python
except Exception as e:
    print("Geminiå‘¼ã³å‡ºã—å¤±æ•—:", e)
    raise
```

---

# 4. æœ¬å½“ã«Geminiã¸é€šä¿¡ã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ ğŸŒ

## tcpdumpã§å¤–éƒ¨é€šä¿¡ã‚’ç¢ºèª

```bash
sudo tcpdump -i en0 host generativelanguage.googleapis.com
```

## åˆ¤æ–­åŸºæº–

| çŠ¶æ³       | æ„å‘³                  |
| -------- | ------------------- |
| é€šä¿¡ãŒå‡ºã¦ã„ã‚‹  | Geminiã«åˆ°é”ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ |
| é€šä¿¡ãŒå‡ºã¦ã„ãªã„ | APIå‘¼ã³å‡ºã—è‡ªä½“ãŒç™ºç”Ÿã—ã¦ã„ãªã„   |

---

# 5. APIã‚­ãƒ¼ã§ã¯ãªãã€Œãƒ¢ãƒ‡ãƒ«æŒ‡å®šã€ãŒåŸå› ã®ã“ã¨ãŒã‚ã‚‹ ğŸ¤–

## å•é¡Œä¾‹

```text
gemini-2.0-flash-exp
```

experimentalæ ã§å¼¾ã‹ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ã€‚

## è§£æ±ºç­–ï¼šå®‰å®šãƒ¢ãƒ‡ãƒ«ã¸å¤‰æ›´

æ¨å¥¨ï¼š

* `gemini-2.5-flash`
* stableç‰ˆãƒ¢ãƒ‡ãƒ«

---

# âœ…æœ€çµ‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

| æ®µéš | ãƒã‚§ãƒƒã‚¯é …ç›®                | æ‰‹æ®µ              |
| -- | --------------------- | --------------- |
| 1  | `.env`ãŒèª­ã‚ã¦ã„ã‚‹ã‹         | `load_dotenv()` |
| 2  | HTTP 200ã‚’éä¿¡ã—ã¦ã„ãªã„ã‹     | 200=AIæˆåŠŸã§ã¯ãªã„    |
| 3  | try/exceptã§å¤±æ•—ã‚’éš ã—ã¦ã„ãªã„ã‹ | ãƒ­ã‚°å¿…é ˆ            |
| 4  | Geminié€šä¿¡ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã‹      | `tcpdump`ç¢ºèª     |
| 5  | ãƒ¢ãƒ‡ãƒ«æŒ‡å®šãŒé©åˆ‡ã‹             | expã‚’é¿ã‘stableã¸   |

---

# ğŸ“Œè£œè¶³ï¼ˆå®Ÿå‹™çš„æ”¹å–„ï¼‰

* `/chat`å†…ã§ã€ŒGeminiå‘¼ã³å‡ºã—é–‹å§‹ãƒ­ã‚°ã€ã‚’å¿…ãšå‡ºã™
* Geminiå¿œç­”å…¨æ–‡ã‚’ä¸€åº¦printã—ã¦ç¢ºèªã™ã‚‹
* expãƒ¢ãƒ‡ãƒ«ã¯é¿ã‘ã€å®‰å®šç‰ˆã‚’å„ªå…ˆã™ã‚‹
